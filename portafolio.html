<!DOCTYPE html>
<html lang="es-MX">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portafolio — Blue Origin Replica</title>

  <link rel="icon" href="assets/img/logo.png" type="image/png" />
  <link rel="preconnect" href="https://d1o72l87sylvqg.cloudfront.net" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{--blue:#0033DD;--blue-dark:#062dc7;--white:#fff;--foot-left:#1b1b1b;--foot-right:#3b3b3b;--line:#2b2b2b}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{background:#000;color:#fff;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans",sans-serif}
    a,button,[role="button"],.cta,.burger,.translate-button,.icons a,.oc-close,.oc-link,.btn,.btn-ghost,.btn-solid,.btn-view,.submit,.week>summary{cursor:pointer}
    input,textarea,select{cursor:text}
    .visuallyHidden{position:absolute!important;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden;white-space:nowrap}

    /* ===== HEADER ===== */
    .topbar{position:sticky;top:0;z-index:1000;background:var(--blue);height:96px;display:flex;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,.25)}
    .nav{width:100%;padding:0 30px;height:96px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center;column-gap:24px}
    .brand img{height:52px;width:auto;display:block}
    .nav-center{justify-self:center;display:flex;gap:54px;text-transform:uppercase;letter-spacing:.2em;font-weight:800;font-size:13px}
    .nav-center a{color:rgba(255,255,255,.95);text-decoration:none}
    .nav-center a:hover{color:#fff}
    .nav-right{justify-self:end;display:flex;gap:12px;align-items:center;justify-content:flex-end}
    .translate-button{background:#0033DD;border:none;border-radius:5px;padding:10px 20px;color:#fff;font-size:16px;display:flex;align-items:center;gap:12px}
    .translate-button svg{width:24px;height:24px}
    .cta{display:inline-flex;align-items:center;justify-content:center;height:42px;padding:0 18px;border-radius:8px;background:#fff;color:#0033dd;font-weight:900;letter-spacing:.2em;text-transform:uppercase;font-size:12px;border:1px solid rgba(0,0,0,.06);text-decoration:none}
    .burger{width:42px;height:42px;background:transparent;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:6px;border:none}
    .burger i,.burger::before{content:"";display:block;width:35px;height:5px;background:#fff;border-radius:2px}
    @media (max-width:1200px){.nav-center{display:none}}

    /* small avatar / user menu */
    .user-btn{display:inline-flex;align-items:center;gap:10px;background:transparent;border:0;color:#fff}
    .user-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,.12)}
    .user-name{font-weight:800;letter-spacing:.04em}

    /* loading spinner */
    .spinner{width:34px;height:34px;border-radius:50%;border:4px solid rgba(255,255,255,.12);border-top-color:#fff;animation:spin .9s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* dropdown */
    .user-dropdown{position:absolute;right:24px;top:72px;background:#222;border:1px solid rgba(255,255,255,.08);padding:8px;border-radius:8px;min-width:180px;box-shadow:0 10px 30px rgba(0,0,0,.5);display:none;z-index:1600}
    .user-dropdown a, .user-dropdown button{display:block;padding:10px 12px;color:#fff;text-decoration:none;background:transparent;border:0;text-align:left;width:100%}
    .user-dropdown a:hover, .user-dropdown button:hover{background:#2b2b2b;border-radius:6px}

    /* ===== HERO ===== */
    .hero{height:526px;position:relative;display:flex;align-items:flex-end;overflow:hidden;background:#000}
    .hero::before{content:"";position:absolute;inset:0;background:url("https://midu.dev/courses/ultimas-novedades-javascript.webp") center/cover no-repeat}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(0deg,rgba(0,0,0,.84)0%,rgba(0,0,0,.55)50%,rgba(0,0,0,.28)100%)}
    .hero-inner{position:relative;z-index:1;width:100%;max-width:1200px;padding:80px 22px}
    .kicker{font-size:12px;letter-spacing:.22em;text-transform:uppercase;font-weight:800;color:rgba(255,255,255,.8);margin-bottom:8px}
    h1{margin:0;text-transform:uppercase;font-weight:800;font-size:clamp(34px,5vw,60px)}
    .ns{display:block;font-weight:900;letter-spacing:.06em;font-size:clamp(40px,8vw,80px);margin:.1em 0 .6em}
    .btn{color:#fff;text-decoration:none;border:2px solid rgba(255,255,255,.85);padding:12px 16px;border-radius:8px;font-weight:800;letter-spacing:.2em;text-transform:uppercase;display:inline-block}
    .btn:hover{background:#fff;color:#0033dd}

    /* ===== OFF-CANVAS ===== */
    .oc-overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      backdrop-filter:saturate(130%) blur(2px);
      opacity:0; pointer-events:none;
      transition:opacity .25s ease;
      z-index:1200;
    }
    .oc-panel{
      position:fixed; top:0; right:0; height:100dvh;
      width:min(420px,88vw);
      background:#2e2e2e; color:#fff;
      transform:translateX(100%);
      transition:transform .28s ease;
      z-index:1300;
      display:flex; flex-direction:column;
      box-shadow:-8px 0 22px rgba(0,0,0,.45);
    }
    body.oc-open .oc-overlay{ opacity:1; pointer-events:auto; }
    body.oc-open{ overflow:hidden; }
    body.oc-open .oc-panel{ transform:translateX(0); }
    .oc-header{display:flex;align-items:center;justify-content:space-between;padding:22px 20px;border-bottom:1px solid rgba(255,255,255,.12)}
    .oc-feather{height:28px}
    .oc-close{width:40px;height:40px;border-radius:8px;border:1px solid rgba(255,255,255,.4);background:transparent;color:#fff;font-size:18px;display:inline-flex;align-items:center;justify-content:center}
    .oc-content{padding:10px 20px 24px;overflow:auto}
    .oc-link{display:block;padding:12px 2px;color:#fff;text-decoration:none;text-transform:uppercase;letter-spacing:.16em;font-weight:800;border-bottom:1px solid rgba(255,255,255,.08)}
    .oc-link:hover{background:#3a3a3a}
    .oc-footer{margin-top:auto;padding:14px 20px;border-top:1px solid rgba(255,255,255,.12);display:flex;gap:10px;flex-wrap:wrap}
    .oc-footer a{color:#fff;text-decoration:none;font-size:13px;opacity:.9}
    .oc-footer a:hover{opacity:1;text-decoration:underline}

    /* ===== FOOTER (igual) ===== */
    footer{display:grid;grid-template-columns:45% 22% 33%;height:635px;background:linear-gradient(90deg,var(--foot-left)0 67.6%,var(--foot-right)67.6% 100%);color:#fff;border-top:1px solid #232323}
    .foot-left{padding:80px 40px 40px 120px;display:flex;flex-direction:column;justify-content:center}
    .feather{width:340px;max-width:90%;margin:0 0 28px 0;filter:brightness(1.05)}
    .legal{margin-top:8px;font-size:14px;color:#d9d9d9}
    .legal-links{margin-top:18px;display:flex;gap:24px}
    .legal-links a{color:#fff;text-decoration:none;font-size:14px;border-bottom:1px solid rgba(255,255,255,.35);padding-bottom:3px}
    .legal-links a:hover{border-bottom-color:#fff}
    .foot-center{position:relative;padding:60px 40px 60px 0}
    .foot-center::before{content:"";position:absolute;left:0;top:38px;bottom:38px;width:1px;background:var(--line)}
    .menu{padding-left:40px;display:flex;flex-direction:column;gap:26px}
    .menu a{color:#fff;text-decoration:none;font-size:16px;letter-spacing:.04em}
    .menu a:hover{text-decoration:underline}
    .select-wrap{margin-top:6px;width:330px;position:relative}
    .select{width:100%;appearance:none;background:transparent;color:#fff;border:2px solid #fff;border-radius:8px;padding:12px 42px 12px 16px;font-size:14px}
    .select-wrap::after{content:"▾";position:absolute;right:14px;top:50%;transform:translateY(-50%);font-size:16px;color:#fff}
    .foot-right{background:var(--foot-right);padding:60px 56px;display:flex;flex-direction:column;gap:14px}
    .foot-right h3{font-size:22px;font-weight:800;margin-bottom:6px}
    .foot-right p{color:#e1e1e1;font-size:15px;line-height:1.6}
    .req{color:#ccc;font-size:13px;margin:2px 0 6px}
    .label{font-size:14px;font-weight:800;text-transform:uppercase;letter-spacing:.08em;margin:10px 0 6px}
    .input{width:min(740px,100%);height:46px;background:transparent;border:2px solid #fff;border-radius:4px;color:#fff;padding:0 10px;font-size:15px}
    .check{display:flex;align-items:flex-start;gap:12px;margin-top:12px}
    .box{width:18px;height:18px;border:2px solid #fff;background:transparent;display:inline-block;flex-shrink:0}
    .check p{color:#e1e1e1;font-size:14px;line-height:1.6}
    .submit{align-self:flex-start;margin-top:14px;background:transparent;color:#fff;border:2px solid #fff;border-radius:4px;padding:8px 14px;text-transform:uppercase;letter-spacing:.12em;font-weight:800;font-size:13px}
    .submit:hover{background:#fff;color:#000}
    @media(max-width:1100px){
      footer{grid-template-columns:1fr;height:auto}
      .foot-center::before{display:none}
      .menu{padding-left:0}
      .foot-left,.foot-center,.foot-right{padding:28px 22px}
      .feather{width:220px}
    }

    /* ===== PORTAFOLIO ===== */
    .weeks{background:#000;color:#fff;padding:56px 22px 88px}
    .weeks .wrap{max-width:1200px;margin:0 auto}
    .weeks h2{color:#fff;text-align:center;font-size:clamp(30px,5vw,52px);font-weight:900;margin:0 0 22px}
    .weeks .lead{color:#ddd;text-align:center;margin:0 auto 24px;max-width:780px}
    .accordion{display:grid;gap:18px;margin-top:10px}
    .week{border:1px solid rgba(0,0,0,.08);border-radius:14px;overflow:hidden;background:#101217}
    .week>summary{display:flex;align-items:center;gap:12px;list-style:none;background:#4d2ca9;padding:16px 18px;font-weight:900;letter-spacing:.02em;color:#e9e9ff;font-size:18px}
    .week>summary::-webkit-details-marker{display:none}
    .week .badge{display:inline-grid;place-items:center;width:34px;height:34px;border-radius:10px;background:#001a22;color:#00e5ff;font-size:16px}
    .panel{padding:18px}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:22px;align-items:stretch}
    .card{background:#171a1f;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:18px;display:flex;flex-direction:column;gap:12px;color:#e8eaf0}
    .card h4{font-size:16px;line-height:1.35}
    .thumb{background:#0f1117;border:1px dashed rgba(255,255,255,.12);border-radius:10px;height:220px;display:grid;place-items:center;overflow:hidden}
    .thumb img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .thumb .pdf{font-size:74px;color:#ff5252;opacity:.95}
    .thumb iframe.pdf-viewer{width:100%;height:100%;border:0;border-radius:10px;background:#0f1117}
    .actions{margin-top:auto;display:grid;gap:10px}
    .btn-ghost,.btn-solid{height:44px;border-radius:10px;font-weight:800;letter-spacing:.05em;display:inline-flex;align-items:center;justify-content:center;gap:10px;text-decoration:none}
    .btn-ghost{border:2px solid rgba(255,255,255,.12);color:#e8eaf0;background:#1a1f27}
    .btn-ghost:hover{border-color:rgba(255,255,255,.22)}
    .btn-solid{border:0;background:var(--blue);color:#fff}
    .btn-solid:hover{filter:brightness(1.06)}
    .btn-view{background:#00d27a;color:#001b10}

    /* ===== SOCIAL BAR ===== */
    .social-bar{background:var(--blue);padding:18px 20px;display:flex;justify-content:center;align-items:center;gap:22px}
    .social-bar span{font-size:13px;letter-spacing:.2em;text-transform:uppercase;font-weight:800}
    .icons{display:flex;gap:18px;align-items:center}
    .icons a{width:34px;height:34px;border:2px solid #fff;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;color:#fff;font-size:18px;text-decoration:none}

    /* ===== VISOR MODAL ===== */
    .viewer-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:1400}
    .viewer-overlay.open{display:flex}
    .viewer-dialog{width:min(1200px,95vw);height:min(90vh,900px);background:#111;border:1px solid rgba(255,255,255,.15);border-radius:14px;box-shadow:0 12px 38px rgba(0,0,0,.6);display:flex;flex-direction:column;overflow:hidden}
    .viewer-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.1)}
    .viewer-title{font-weight:800;letter-spacing:.04em}
    .viewer-actions{display:flex;gap:8px}
    .viewer-actions a,.viewer-close{height:36px;padding:0 12px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:#1a1f27;color:#fff;text-decoration:none;display:inline-flex;align-items:center;gap:8px;font-size:14px}
    .viewer-actions a:hover,.viewer-close:hover{background:#242b36}
    .viewer-body{flex:1;position:relative;background:#0f1117}
    .viewer-body iframe{position:absolute;inset:0;border:0;width:100%;height:100%}
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <header class="topbar">
    <nav class="nav" aria-label="Principal">
      <a class="brand" href="index.html">
        <img src="https://upla.edu.pe/web/wp-content/uploads/2025/06/upla-white.png" alt="BLUE ORIGIN">
      </a>

      <div class="nav-center" role="navigation" aria-label="Enlaces principales">
        <a href="index.html">Inicio</a>
        <a href="perfil.html">Perfil</a>
        <a href="parcial.html">Parcial</a>
        <a href="portafolio.html" aria-current="page">Portafolio</a>
        <a href="contacto.html">Contacto</a>
      </div>

      <div class="nav-right" id="nav-right">
        <!-- translate always visible -->
        <button type="button" class="translate-button" aria-label="Translate">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" role="img" aria-labelledby="translateIcon">
            <title id="translateIcon">Translate</title>
            <path d="M3 5h4m0 0h4M7 5V3m-4 9c5.4-1.5 6.6-7 6.6-7m-4 3c1 1.5 2.7 3.2 5.4 4m-8 3v2c0 1.1.9 2 2 2h4m0 0-3-2v4l3-2ZM21 9V7a2 2 0 0 0-2-2h-4m0 0 3 2V3l-3 2Zm6 16-4-9-4 9m.9-2H20" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>

        <!-- auth dynamic area -->
        <div id="auth-area" style="display:inline-flex;align-items:center;gap:12px">
          <!-- initial placeholder: spinner -->
          <div class="spinner" aria-hidden="true" id="auth-spinner" title="Cargando estado de sesión"></div>
        </div>

        <button class="burger" id="oc-trigger" aria-haspopup="dialog" aria-controls="offcanvas" aria-expanded="false" aria-label="Abrir menú">
          <span class="visuallyHidden">Main menu</span><i></i>
        </button>
      </div>
    </nav>
  </header>

  <!-- ===== HERO ===== -->
  <main class="hero" aria-label="Portafolio">
    <div class="hero-inner">
      <div class="kicker">Mis Proyectos</div>
      <h1>Portafolio</h1>
      <strong class="ns">Trabajos Destacados</strong>
      <p>Aquí puedes mostrar tus proyectos, piezas gráficas, enlaces a repos y PDFs.</p>
      <a class="btn" href="index.html">Volver al Inicio</a>
    </div>
  </main>

  <!-- ===== PORTAFOLIO POR SEMANAS ===== -->
  <section class="weeks" id="por-semanas">
    <div class="wrap">
      <h2>Portafolio Organizado por Semanas</h2>
      <p class="lead">Sube aquí tus evidencias por semana.</p>

      <div class="accordion">
        <!-- (el contenido de semanas lo mantuve como lo tenías; lo puedes extender) -->
        <details class="week" open>
          <summary><span class="badge"><i class="fa-solid fa-calendar-week"></i></span> Semana 1</summary>
          <div class="panel"><div class="cards">

            <article class="card">
              <h4>Sílabo del curso</h4>
              <div class="thumb"><i class="fa-solid fa-file-pdf pdf"></i></div>
              <div class="actions">
                <a class="btn-ghost btn-view" href="assets/pdfs/1757563954874_VIII_ArquitecturaDeSoftware.pdf" data-title="Sílabo del curso">
                  <i class="fa-solid fa-up-right-from-square"></i> Ver archivo
                </a>
                <a class="btn-solid" href="assets/pdfs/1757563954874_VIII_ArquitecturaDeSoftware.pdf" download>
                  <i class="fa-solid fa-download"></i> Descargar
                </a>
              </div>
            </article>

            <article class="card">
              <h4>Clases (PDF)</h4>
              <div class="thumb"><i class="fa-solid fa-file-pdf pdf"></i></div>
              <div class="actions">
                <a class="btn-ghost btn-view" href="assets/pdfs/Clases.pdf" data-title="Clases (PDF)">
                  <i class="fa-solid fa-up-right-from-square"></i> Ver archivo
                </a>
                <a class="btn-solid" href="assets/pdfs/Clases.pdf" download>
                  <i class="fa-solid fa-download"></i> Descargar
                </a>
              </div>
            </article>

            <article class="card">
              <h4>Mapa Mental</h4>
              <div class="thumb"><img src="assets/img/semana1Trabajo.png" alt="Imagen UPLA"></div>
              <div class="actions">
                <a class="btn-ghost btn-view" href="assets/img/semana1Trabajo.png" data-title="Imagen de UPLA">
                  <i class="fa-solid fa-up-right-from-square"></i> Ver archivo
                </a>
                <a class="btn-solid" href="assets/img/semana1Trabajo.png" download>
                  <i class="fa-solid fa-download"></i> Descargar
                </a>
              </div>
            </article>

          </div></div>
        </details>

        <!-- (resto de semanas...) -->
        <!-- Puedes pegar tus otras semanas aquí tal como en tu original -->
      </div>
    </div>
  </section>

  <!-- ===== SOCIAL BAR ===== -->
  <div class="social-bar">
    <span>SÍGUENOS EN NUESTRAS REDES</span>
    <div class="icons">
      <a href="#" aria-label="X / Twitter"><i class="fa-brands fa-twitter"></i></a>
      <a href="#" aria-label="Facebook"><i class="fa-brands fa-facebook-f"></i></a>
      <a href="#" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
      <a href="#" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
      <a href="#" aria-label="LinkedIn"><i class="fa-brands fa-linkedin-in"></i></a>
    </div>
  </div>

  <!-- ===== OFF-CANVAS ===== -->
  <div class="oc-overlay" id="oc-overlay" aria-hidden="true"></div>

  <aside
    class="oc-panel"
    id="offcanvas"
    role="dialog"
    aria-modal="true"
    aria-labelledby="oc-title"
    aria-hidden="true"
    tabindex="-1"
  >
    <div class="oc-header">
      <img class="oc-feather" src="https://d1o72l87sylvqg.cloudfront.net/blue-origin/logo-feather-optimized.svg" alt="">
      <button class="oc-close" id="oc-close" aria-label="Cerrar menú"><span aria-hidden="true">✕</span></button>
    </div>

    <div class="oc-content">
      <h2 id="oc-title" class="visuallyHidden">Menú principal</h2>
      <a class="oc-link" href="index.html">Inicio</a>
      <a class="oc-link" href="perfil.html">Perfil</a>
      <a class="oc-link" href="parcial.html">Parcial</a>
      <a class="oc-link" href="portafolio.html">Portafolio</a>
      <a class="oc-link" href="contacto.html">Contacto</a>
      <a class="oc-link" href="login.html">Iniciar Sesión</a>
    </div>

    <div class="oc-footer">
      <a href="#">Política de Privacidad</a>
      <a href="#">Términos de Uso</a>
      <a href="#">Accesibilidad</a>
    </div>
  </aside>

  <!-- ===== FOOTER ===== -->
  <footer>
    <section class="foot-left">
      <img class="feather" src="https://d1o72l87sylvqg.cloudfront.net/blue-origin/logo-feather-optimized.svg" alt="Blue Origin Feather">
      <div class="legal">© 2025 BLUE ORIGIN</div>
      <div class="legal-links"><a href="#">Política de Privacidad</a><a href="#">Términos de Uso</a></div>
    </section>
    <section class="foot-center">
      <nav class="menu">
        ENLACES RÁPIDOS
        <a href="index.html">Inicio</a><a href="perfil.html">Perfil</a><a href="parcial.html">Parcial</a><a href="portafolio.html">Portafolio</a><a href="contacto.html">Contacto</a><a class="oc-link" href="login.html">Iniciar Sesión</a>
        <div class="select-wrap"><select class="select"><option selected>Sin preferencia (predeterminado)</option><option>Sans Serif</option><option>Serif</option><option>High Contrast</option></select></div>
      </nav>
    </section>
    <section class="foot-right">
    <h3>Suscribirse</h3>
    <p>Regístrate para recibir actualizaciones sobre los anuncios, lanzamientos y oportunidades de Trabajos.</p>
    <div class="req">* indica un campo requerido</div>
    <label class="label" for="email">Correo electrónico *</label>
    <input class="input" id="email" type="email" required>
    <div class="check">
      <span class="box" role="checkbox" aria-checked="false" tabindex="0"></span>
      <p>Por favor, haga clic para confirmar su consentimiento para recibir actualizaciones por correo electrónico de nuestra parte. Nota: tiene el derecho de retirar su consentimiento en cualquier momento contactándonos a josuenehemiasatucusi@gmail.com o haciendo clic en el enlace de "cancelar suscripción" en los correos electrónicos que le enviamos. Por favor, revise nuestra <u>política de privacidad</u> para más información sobre cómo procesamos sus datos.</p>
    </div>
    <button class="submit" type="button">Enviar</button>
  </section>
  </footer>

  <!-- ===== VISOR MODAL (PDF.js) ===== -->
  <div class="viewer-overlay" id="viewer" aria-hidden="true">
    <div class="viewer-dialog" role="dialog" aria-modal="true" aria-labelledby="viewer-title">
      <header class="viewer-head">
        <div class="viewer-title" id="viewer-title">Vista Previa</div>
        <div class="viewer-actions">
          <a id="viewer-open" target="_blank" rel="noopener"><i class="fa-solid fa-arrow-up-right-from-square"></i> Abrir en pestaña</a>
          <a id="viewer-download" download><i class="fa-solid fa-download"></i> Descargar</a>
          <button class="viewer-close" id="viewer-close" aria-label="Cerrar"><i class="fa-solid fa-xmark"></i> Cerrar</button>
        </div>
      </header>
      <div class="viewer-body" id="viewer-body"></div>
    </div>
  </div>

  <!-- ===== JS ===== -->
  <script>
    /* ===== Off-canvas (JS corregido con focus-trap) ===== */
    const oc = {
      body: document.body,
      trigger: document.getElementById('oc-trigger'),
      overlay: document.getElementById('oc-overlay'),
      panel: document.getElementById('offcanvas'),
      closeBtn: document.getElementById('oc-close'),
      lastFocus: null
    };
    const FOCUSABLE = 'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])';

    function setAriaOpen(isOpen){
      oc.trigger?.setAttribute('aria-expanded', String(isOpen));
      oc.panel.setAttribute('aria-hidden', String(!isOpen));
      oc.overlay.setAttribute('aria-hidden', String(!isOpen));
    }
    function trapTab(e){
      if (!document.body.classList.contains('oc-open') || e.key !== 'Tab') return;
      const nodes = oc.panel.querySelectorAll(FOCUSABLE);
      if (!nodes.length) return;
      const first = nodes[0], last = nodes[nodes.length - 1];
      if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }
    function onKeydown(e){
      if (!document.body.classList.contains('oc-open')) return;
      if (e.key === 'Escape') closeOC();
      trapTab(e);
    }
    function openOC(){
      oc.lastFocus = document.activeElement;
      oc.body.classList.add('oc-open');
      setAriaOpen(true);
      const first = oc.panel.querySelector(FOCUSABLE) || oc.closeBtn;
      (first || oc.panel).focus();
      document.addEventListener('keydown', onKeydown);
    }
    function closeOC(){
      oc.body.classList.remove('oc-open');
      setAriaOpen(false);
      document.removeEventListener('keydown', onKeydown);
      oc.panel.blur();
      if (oc.lastFocus && oc.lastFocus.focus) oc.lastFocus.focus();
    }

    oc.trigger?.addEventListener('click', openOC);
    oc.closeBtn?.addEventListener('click', closeOC);
    oc.overlay?.addEventListener('click', closeOC);

    /* ===== Acordeón: una semana abierta ===== */
    document.querySelectorAll('details.week').forEach(d=>{
      d.addEventListener('toggle',()=>{
        if(d.open) document.querySelectorAll('details.week').forEach(o=>{
          if(o!==d) o.open=false;
        });
      });
    });

    /* ===== Mini-previews en tarjetas (PDF -> iframe con zoom 75%) ===== */
    document.addEventListener('DOMContentLoaded',()=>{
      document.querySelectorAll('.card').forEach(card=>{
        const viewBtn=card.querySelector('.btn-view');
        const thumb =card.querySelector('.thumb');
        if(!viewBtn || !thumb) return;
        const href=(viewBtn.getAttribute('href')||'');
        if(href.toLowerCase().endsWith('.pdf')){
          thumb.innerHTML='';
          const iframe=document.createElement('iframe');
          iframe.src=new URL(href, window.location.href).toString() + '#zoom=75';
          iframe.className='pdf-viewer';
          iframe.title='Vista previa PDF';
          thumb.appendChild(iframe);
        }
      });
    });

    /* ===== Visor PDF.js (miniaturas + zoom 75%) ===== */
    const viewer = document.getElementById('viewer');
    const viewerBody = document.getElementById('viewer-body');
    const viewerTitle = document.getElementById('viewer-title');
    const viewerOpen = document.getElementById('viewer-open');
    const viewerDownload = document.getElementById('viewer-download');
    const viewerClose = document.getElementById('viewer-close');

    const PDFJS_VIEWER = "https://mozilla.github.io/pdf.js/web/viewer.html";
    const absUrl = (href)=> new URL(href, window.location.href).toString();
    const pdfjsUrl = (fileAbs)=> `${PDFJS_VIEWER}?file=${encodeURIComponent(fileAbs)}#pagemode=thumbs&zoom=75`;

    function openViewer(url, title='Vista Previa'){
      const abs = absUrl(url);
      const pdfjs = pdfjsUrl(abs);
      viewerBody.innerHTML='';
      viewerTitle.textContent = title || 'Vista Previa';
      viewerOpen.href = pdfjs;     // abre el visor PDF.js
      viewerOpen.setAttribute('aria-label', 'Abrir en pestaña nueva');
      viewerDownload.href = abs;   // descarga original
      const iframe = document.createElement('iframe');
      iframe.src = abs.toLowerCase().endsWith('.pdf') ? pdfjs : abs;
      iframe.title = 'Visor';
      viewerBody.appendChild(iframe);
      viewer.classList.add('open');
      viewer.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
      viewerClose.focus();
    }
    function closeViewer(){
      viewer.classList.remove('open');
      viewer.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
      viewerBody.innerHTML='';
    }
    document.addEventListener('click',(e)=>{
      const a = e.target.closest('a.btn-view');
      if(!a) return;
      e.preventDefault();
      const url = a.getAttribute('href');
      const title = a.getAttribute('data-title') || a.closest('.card')?.querySelector('h4')?.textContent || 'Vista Previa';
      openViewer(url, title);
    });
    viewerClose.addEventListener('click', closeViewer);
    viewer.addEventListener('click', (e)=>{ if(e.target===viewer) closeViewer(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && viewer.classList.contains('open')) closeViewer(); });
  </script>

  <!-- ===== AUTH-HEADER: detecta sesión y actualiza header ===== -->
  <script>
    // Lógica: intenta importar ./firebaseauth.js y suscribirse al estado.
    // Si no existe, se intenta usar firebase global; si no, se asume 'logged out'.
    (function(){
      const authArea = document.getElementById('auth-area');
      const spinner = document.getElementById('auth-spinner');
      let authModule = null;
      let currentUser = null;
      let dropdownEl = null;

      function clearAuthArea(){
        authArea.innerHTML = '';
      }

      function buildGuestUI(){
        clearAuthArea();
        const loginLink = document.createElement('a');
        loginLink.className = 'cta';
        loginLink.href = 'login.html';
        loginLink.textContent = 'Iniciar sesión';
        loginLink.setAttribute('role','button');
        authArea.appendChild(loginLink);
      }

      function buildUserUI(user){
        clearAuthArea();
        const container = document.createElement('div');
        container.style.position = 'relative';
        // user button
        const btn = document.createElement('button');
        btn.className = 'user-btn';
        btn.type = 'button';
        btn.id = 'user-btn';
        btn.setAttribute('aria-haspopup','true');
        btn.setAttribute('aria-expanded','false');

        const img = document.createElement('img');
        img.className = 'user-avatar';
        img.alt = user.displayName ? `Avatar de ${user.displayName}` : 'Avatar';
        img.src = user.photoURL || 'https://d1o72l87sylvqg.cloudfront.net/blue-origin/avatar-placeholder.png';

        const span = document.createElement('span');
        span.className = 'user-name';
        span.textContent = user.displayName || (user.email ? user.email.split('@')[0] : 'Usuario');

        btn.appendChild(img);
        btn.appendChild(span);
        container.appendChild(btn);

        // dropdown
        const dd = document.createElement('div');
        dd.className = 'user-dropdown';
        dd.id = 'user-dropdown';
        dd.setAttribute('role','menu');
        dd.innerHTML = `
          <a href="perfil.html" role="menuitem">Mi Perfil</a>
          <a href="portafolio.html" role="menuitem">Mis Documentos</a>
          <button id="signOutBtn" type="button" role="menuitem">Cerrar sesión</button>
        `;
        container.appendChild(dd);
        authArea.appendChild(container);
        dropdownEl = dd;

        // toggle dropdown
        btn.addEventListener('click', (ev) => {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          dd.style.display = expanded ? 'none' : 'block';
        });

        // outside click closes dropdown
        document.addEventListener('click', (e)=>{
          if(!container.contains(e.target)){
            dd.style.display = 'none';
            btn.setAttribute('aria-expanded','false');
          }
        });

        // sign out
        const signOutBtn = dd.querySelector('#signOutBtn');
        signOutBtn?.addEventListener('click', async ()=>{
          // intenta usar el módulo importado si tiene signOut
          try{
            if(authModule && typeof authModule.signOut === 'function'){
              await authModule.signOut();
            } else if(window.firebase && firebase.auth){
              await firebase.auth().signOut();
            } else {
              console.warn('No hay método signOut disponible. Se limpiará la UI localmente.');
            }
          }catch(err){
            console.error('Error durante signOut:', err);
          } finally {
            // forzar UI a invitado
            buildGuestUI();
          }
        });
      }

      function showGuestUIAfterLoad(){
        spinner?.remove();
        buildGuestUI();
      }

      function showUserUIAfterLoad(user){
        spinner?.remove();
        buildUserUI(user);
      }

      function handleAuthChanged(user){
        currentUser = user;
        if(user){
          showUserUIAfterLoad(user);
        } else {
          showGuestUIAfterLoad();
        }
      }

      async function initAuthDetection(){
        // small timeout so spinner is visible a moment
        try{
          // intenta importar tu módulo firebaseauth.js
          authModule = await import('./firebaseauth.js').catch(()=>null);
          if(authModule){
            // si el módulo expone onAuthStateChanged or getAuthState, úsalo
            if(typeof authModule.onAuthStateChanged === 'function'){
              authModule.onAuthStateChanged(handleAuthChanged);
              return;
            }
            if(typeof authModule.getAuthState === 'function'){
              authModule.getAuthState(handleAuthChanged);
              return;
            }
            // si sólo expone resolveGoogleRedirect o googleSignIn, intentar leer firebase global
          }
          // fallback: intenta usar firebase global SDK
          if(window.firebase && firebase.auth && typeof firebase.auth === 'function'){
            firebase.auth().onAuthStateChanged(handleAuthChanged);
            return;
          }
          // si no hay nada, asumimos invitado
          handleAuthChanged(null);
        }catch(err){
          console.error('initAuthDetection error',err);
          handleAuthChanged(null);
        }
      }

      // inicializa cuando DOM listo
      document.addEventListener('DOMContentLoaded', ()=>{
        // deja spinner 700ms visible para mostrar "loading" si la detección es muy rápida
        initAuthDetection();
      });
    })();
  </script>

  <!-- (Opcional) tus scripts -->
  <script type="module" src="usermenu.js"></script>
  <script src="offcanvas.js" defer></script>
</body>
</html>
